name: Bing Wallpaper

on:
  workflow_dispatch:
  schedule:
    - cron: '0 16 * * *' 

jobs:
  download:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
    - uses: actions/checkout@v4
      with:
        fetch-depth: 0 
    
    - name: ä¸‹è½½å¹¶æäº¤BingèƒŒæ™¯å›¾
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        
        TODAY=$(date +'%Y%m%d')
        echo "ä»Šæ—¥æ—¥æœŸ: $TODAY"
        
        mkdir -p bing-wallpaper
        
        echo "å¼€å§‹ä¸‹è½½å›¾ç‰‡..."
        curl -L -o "bing-wallpaper/$TODAY.jpg" \
          -H "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36" \
          --connect-timeout 30 \
          --max-time 120 \
          "https://bing.img.run/uhd.php"
        
        if [ -f "bing-wallpaper/$TODAY.jpg" ] && [ -s "bing-wallpaper/$TODAY.jpg" ]; then
          FILE_SIZE=$(stat -c%s "bing-wallpaper/$TODAY.jpg")
          echo "ä¸‹è½½æˆåŠŸï¼Œæ–‡ä»¶å¤§å°: $FILE_SIZE å­—èŠ‚"
          
          git pull --rebase
          git add bing-wallpaper/$TODAY.jpg
          git commit -m "ğŸ–¼ï¸ æ·»åŠ æ¯æ—¥BingèƒŒæ™¯å›¾: $TODAY"
          git push
          
          echo "âœ… æˆåŠŸæäº¤åˆ°ä»“åº“"
        else
          echo "âŒ ä¸‹è½½å¤±è´¥æˆ–æ–‡ä»¶ä¸ºç©º"
          exit 1
        fi
